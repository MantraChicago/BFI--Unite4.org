a.close-reveal-modal &#215;
.need_modal.cash_donations_modal
  
  .wizard
    form.need_form.custom 
      .steps-wrapper
        .step.active 
          = render 'cash_donations/partials/first_wizard_tab', :need => @need
        .step 
          = render 'cash_donations/partials/second_wizard_tab', :need => @need
      .wizard-navigation.centered
        a.button.button-previous style="display:none"
          | Back
        a.button.button-next
          | Next
        a.button.button-submit.pink.hide
          | Submit
  .success.hide
    = render 'cash_donations/partials/success', :need => @need

javascript:
  $(document).foundation();
  $.getScript('https://js.stripe.com/v2/',function(){
  
    Stripe.setPublishableKey('#{SimpleSettings.config[:stripe][:public_key]}');
      $('.button-submit').click(function(){
        $('.cash_submit').attr('disabled','true')

        $('.payment-errors').html('<span style="color:green">Processing</span>')

        Stripe.card.createToken({
            number: $('.cc_number').val(),
            cvc: $('.cvc').val(),
            exp_month: $('.month').val(),
            exp_year: $('.year').val()
        }, stripeResponseHandler);
        
      })

    })

    var stripeResponseHandler = function (status, response) {
        if (response.error) {
        
            // show the errors on the form
            $(".payment-errors").text(response.error.message);
            $('.cash_submit').removeAttr('disabled')
        } else {
            var form$ = $(".need_form");
            
            // token contains id, last4, and card type
            var token = response['id'];
            // insert the token into the form so it gets submitted to the server
            form$.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");

            var form_data=$('.need_form').serializeObject()
            $.post('/causes/#{@need.cause.slug}/#{@need.type_of_need}/#{@need.id}/fulfillments',form_data, function(data){

            })
        }
      }